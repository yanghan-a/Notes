# 问题解答

## 编译、架构、指令

### **常用的C/C++编译器**

**GCC (GNU Compiler Collection)**：一个开源编译器，支持多种语言，包括 C 和 C++，广泛用于 Linux 和嵌入式开发。

**Clang**：由 LLVM 项目开发的编译器，支持 C、C++ 和 Objective-C，强调快速编译和良好的错误提示。

**MSVC (Microsoft Visual C++)**：微软的编译器，主要用于 Windows 平台的应用开发，集成在 Visual Studio 中。

**MinGW (Minimalist GNU for Windows)**：在 Windows 上提供 GCC 的简化版本，适合开发本地应用。

**Intel C++ Compiler (ICC)**：由 Intel 提供的编译器，针对 Intel 处理器进行了优化，提供高级优化功能。

**Borland C++**：早期流行的编译器，主要用于 Windows 应用开发，现已较少使用。

**Embarcadero C++Builder**：用于快速应用开发的集成开发环境，支持 VCL 和 FMX 框架。

### windows和linux都能使用的arm编译器

**GCC for ARM (arm-none-eabi-gcc)**：一个广泛使用的开源交叉编译器，适用于嵌入式系统开发。

### 代码编译流程

**预处理**：在这一阶段，编译器处理以 `#` 开头的指令，如 `#include` 和 `#define`，生成一个经过预处理的源文件。这一阶段的输出是一个纯文本的 C/C++ 文件。

**编译**：这一阶段将预处理后的源代码转换为汇编代码。编译器将 C/C++ 代码转换为特定于目标架构的汇编语言。这一过程包括语法分析、语义分析和代码生成。

**汇编**：在这一阶段，汇编器将汇编代码转换为机器码（目标文件），这是一种可执行的二进制格式。汇编器负责将汇编指令转换为对应的机器指令，并生成目标文件。

**链接**：链接器将一个或多个目标文件与库文件结合，生成最终的可执行文件。这一阶段处理符号解析和地址重定位。

### 常见指令集

**x86**：

- 指令集：Intel 8086 指令集
- 特点：复杂指令集（CISC），支持多种数据类型和寻址模式。

**x86-64**：

- 指令集：AMD64 指令集（扩展 x86）
- 特点：64 位扩展，支持更大的内存寻址，向后兼容 x86。

**ARM**：

- 指令集：ARM 指令集架构（包括 ARM 和 Thumb 模式）
- 特点：精简指令集（RISC），高效能低功耗，广泛用于移动设备和嵌入式系统。

**RISC-V**：

- 指令集：RISC-V 指令集架构
- 特点：开源，模块化设计，适用于高性能计算和嵌入式应用。

**PowerPC**：

- 指令集：PowerPC 指令集
- 特点：RISC 架构，优化高性能计算，曾用于苹果电脑。

**SPARC**：

- 指令集：SPARC 指令集架构
- 特点：RISC 架构，支持多线程和高性能计算，主要用于服务器。

### 嵌入式设备除了arm架构以外的架构

嵌入式设备的芯片并不都是 ARM 架构，但 ARM 确实是最常见的架构之一。其他常见的嵌入式架构还包括：

1. **AVR**：广泛用于小型微控制器，如 Arduino 平台。
2. **PIC**：Microchip 的 PIC 微控制器系列，广泛应用于各种嵌入式系统。
3. **MIPS**：曾经用于一些嵌入式设备，虽然现在较少见。
4. **RISC-V**：一种新兴的开源架构，逐渐被应用于嵌入式设备。
5. **x86/x86-64**：在一些高性能嵌入式应用中使用，如工业控制和网关设备。

因此，虽然 ARM 架构在嵌入式领域非常流行，但并不是唯一的选择。不同的应用场景和需求会选择不同的架构。

### DSP与FPU

DSP范围比FPU更广，通常集成了FPU。FPU硬件处理单元，常用来加速浮点数运算，尤其是sin、cos这种函数

## C/C++代码架构，风格，思路总结

以稚晖君的dummy机械臂项目为例，总结ref板和驱动板的代码风格，代码架构。

### 关节状态更新

这里采取ref板**定时发送**指令的方式，并不是我想的调用函数直接发送。这也解释了为什么在ros中需要服务器来管理任务是否完成。ref发送指令请求移动，驱动板会控制电机运动并返回当前运动到的位置以及是否到达的消息。ref在获取这些消息后会调用callback函数来更新当前各个关节的位置。



## 常见数据通信协议

### CAN协议

协议帧格式：起始帧+ID号+RTR+IDE+r0+数据+CRC+CRC结束帧+

### DBUS协议



### USB协议



## PCB设计中积累常见模块及其型号

### CAN收发器

大疆robomaster C板TJA1044GTK/3模块

稚晖君dummy机械臂 SN65HVD232DR模块

### 磁编码器

MT6816

AS5600

### 电源模块

#### 24V-5V

ME3116

SY8510

TPS54540

#### 5V-3.3V

LP2992

SY8089





## 上位机获取下位机数据，进行复杂运算后交还给下位机做控制

接下来我将描述一个应用场景，我制作了一个机械臂，他的驱动器和主控都是使用的stm32，驱动和主控使用can通信，底层的各种控制模式已经完成编写，现在我需要为机械臂建立动力学模型，这其中包含复杂的运算，因此我想要将这些运算又我的电脑做处理。思路是通过某种速度很快的协议由主控将数据传输给PC端，PC端运算完成后传输给主控，再由主控通过CAN发送给各个驱动器。那么我应该选择什么协议作为PC和主控stm32之前的通信。为了完成这个任务有哪些合适的框架？

GPT：在你的应用场景中，选择合适的通信协议对于实现高效的数据传输至关重要。以下是一些推荐的协议和框架：

### **USB**

- **描述**：USB是一种常用的高速通信接口，能够实现较高的数据传输速率（如USB 2.0可达480 Mbps，USB 3.0可达5 Gbps）。
- **适用性**：适合数据量较大的应用，如实时传感器数据或复杂的模型参数传输。
- **框架**：可以使用STM32的USB库，PC端可以使用libusb或Windows的WinUSB进行通信。

### **Ethernet / TCP/IP**

- **描述**：以太网通信可以实现更高的带宽，特别是使用TCP/IP协议进行数据传输。
- **适用性**：适合需要远程访问或网络集成的应用，适合在局域网中进行快速数据交换。
- **框架**：可以使用FreeRTOS+TCP或LWIP库在STM32上实现TCP/IP通信。PC端可以使用标准的socket编程。

### **Serial (UART) with higher baud rates**

- **描述**：如果USB或Ethernet不适用，可以考虑使用高速串口通信。
- **适用性**：适合简单、短距离的通信，传输速率受限于波特率（如115200波特或更高）。
- **框架**：使用STM32的USART库和PC端的串口库（如pySerial或其他语言的串口库）。

### **CAN over Ethernet (CANopen)**

- **描述**：在某些情况下，可以使用CANoverEthernet协议进行高效的数据传输。
- **适用性**：适合已经在使用CAN的系统，且需要将计算任务移至PC。
- **框架**：使用CANopen库和以太网通信，结合现有的CAN通信架构。

### 推荐的框架

- **STM32CubeMX**：用于配置STM32的各个外设和通信接口。
- **FreeRTOS**：可以在STM32上实现多任务处理，配合TCP/IP或USB通信。
- **MATLAB/Simulink**：可以用于动力学模型的设计和仿真，并支持与STM32的通信。

### 总结

对于你的应用，USB或Ethernet（TCP/IP）可能是最合适的选择，因为它们提供了较高的带宽和灵活性。同时，确保在PC端实现高效的数据处理和传输，以满足实时性要求。